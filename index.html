<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://unpkg.com/@tonconnect/sdk@2.0.5/dist/tonconnect-sdk.min.js"></script>
<script src="https://unpkg.com/@tonconnect/ui-react@1.0.3/dist/ton-connect-ui.min.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ú–∞–≥–∞–∑–∏–Ω</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 16px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f8fafc;
            color: #111827;
        }

        main {
            max-width: 420px;
            margin: 0 auto;
        }

        header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }
        header h1 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
        }
        header span {
            font-size: 22px;
        }

        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 ‚Äî —Å–µ—Ç–∫–∞ –ª–æ—Ç–æ–≤ */
        .lots-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .lot-card {
            background: #ffffff;
            border-radius: 14px;
            padding: 10px 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 1px 4px rgba(15, 23, 42, 0.10);
        }

        .lot-image-placeholder {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 2px solid #111827;
            margin-bottom: 6px;
        }

        .lot-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .lot-desc {
            font-size: 11px;
            color: #6b7280;
            text-align: center;
            min-height: 24px;
        }

        .lot-price {
            font-size: 13px;
            font-weight: 600;
            margin-top: 4px;
            margin-bottom: 6px;
        }

        .btn {
            padding: 8px 14px;
            font-size: 13px;
            font-weight: 600;
            border-radius: 999px;
            border: none;
            cursor: pointer;
        }

        .btn-outline-green {
            background: transparent;
            color: #16a34a;
            border: 1px solid #16a34a;
        }

        .btn-green {
            background: #16a34a;
            color: #ffffff;
        }

        .btn-gray {
            background: #e5e7eb;
            color: #111827;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .hint {
            margin-top: 18px;
            font-size: 11px;
            color: #6b7280;
            text-align: center;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2 ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ */
        .detail-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 1px 6px rgba(15,23,42,0.12);
        }

        .detail-top {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }

        .detail-image {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            border: 2px solid #111827;
        }

        .detail-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .detail-desc {
            font-size: 13px;
            color: #4b5563;
        }

        .qty-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 12px;
        }

        .qty-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .qty-btn {
            width: 32px;
            height: 32px;
            border-radius: 999px;
            border: 1px solid #d1d5db;
            background: #f9fafb;
            font-size: 18px;
            line-height: 0;
            cursor: pointer;
        }

        .qty-value {
            min-width: 32px;
            text-align: center;
            font-weight: 600;
        }

        .detail-price {
            font-size: 16px;
            font-weight: 700;
        }

        .detail-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3 ‚Äî ‚Äú–æ–ø–ª–∞—Ç–∞‚Äù */
        .pay-summary {
            background: #ffffff;
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 1px 6px rgba(15,23,42,0.12);
        }

        .pay-row {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 6px;
        }

        .pay-row.total {
            font-weight: 700;
            font-size: 16px;
            margin-top: 8px;
        }

        .pay-actions {
            margin-top: 16px;
            display: flex;
            gap: 10px;
        }

        @media (max-width: 360px) {
            .lots-grid { grid-template-columns: repeat(2, 1fr); }
            .detail-top { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
<main>
    <header>
        <span>üõí</span>
        <h1>–ú–∞–≥–∞–∑–∏–Ω</h1>
    </header>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: —Å–ø–∏—Å–æ–∫ –ª–æ—Ç–æ–≤ -->
    <section id="screen-list" class="screen active">
        <div class="lots-grid" id="lots-grid"></div>
        <div class="hint">–í—ã–±–µ—Ä–∏ –ª–æ—Ç ‚Üí ¬´–ö–£–ü–ò–¢–¨¬ª –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.</div>
    </section>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ -->
    <section id="screen-detail" class="screen">
        <div class="detail-card">
            <div class="detail-top">
                <div class="detail-image"></div>
                <div>
                    <div id="detail-title" class="detail-title"></div>
                    <div id="detail-desc" class="detail-desc"></div>
                </div>
            </div>

            <div class="qty-row">
                <div class="qty-controls">
                    <button class="qty-btn" data-delta="-1">‚àí</button>
                    <div id="qty-value" class="qty-value">1</div>
                    <button class="qty-btn" data-delta="1">+</button>
                </div>
                <div id="detail-price" class="detail-price"></div>
            </div>

            <div class="detail-actions">
                <button id="btn-back-from-detail" class="btn btn-gray" style="flex:1;">–ù–∞–∑–∞–¥</button>
                <button id="btn-to-pay" class="btn btn-green" style="flex:2;">–ö –û–ü–õ–ê–¢–ï</button>
            </div>
        </div>
    </section>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: –æ–ø–ª–∞—Ç–∞ -->
    <section id="screen-pay" class="screen">
        <div class="pay-summary">
            <div class="pay-row">
                <span>–¢–æ–≤–∞—Ä</span>
                <span id="pay-name"></span>
            </div>
            <div class="pay-row">
                <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</span>
                <span id="pay-qty"></span>
            </div>
            <div class="pay-row">
                <span>–¶–µ–Ω–∞ –∑–∞ —à—Ç.</span>
                <span id="pay-price"></span>
            </div>
            <div class="pay-row total">
                <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</span>
                <span id="pay-total"></span>
            </div>
        </div>

        <div class="pay-actions">
            <button id="btn-back-from-pay" class="btn btn-gray" style="flex:1;">–ù–∞–∑–∞–¥</button>
            <button id="btn-pay" class="btn btn-green" style="flex:2;">–û–ü–õ–ê–¢–ò–¢–¨</button>
        </div>

        <div class="hint">–ó–¥–µ—Å—å –ø–æ–∫–∞ —Ç–µ—Å—Ç–æ–≤–∞—è ‚Äú–æ–ø–ª–∞—Ç–∞‚Äù –±–µ–∑ –Ω–∞—Å—Ç–æ—è—â–∏—Ö –¥–µ–Ω–µ–≥.</div>
    </section>
</main>

<script>
    const tg = window.Telegram ? Telegram.WebApp : null;

    const products = [
        { id: 1, name: "–ª–æ—Ç 1", price: 500, description: "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ 1" },
        { id: 2, name: "–ª–æ—Ç 2", price: 700, description: "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ 2" },
        { id: 3, name: "–ª–æ—Ç 3", price: 900, description: "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ 3" },
        { id: 4, name: "–ª–æ—Ç 1", price: 500, description: "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ 4" },
        { id: 5, name: "–ª–æ—Ç 2", price: 700, description: "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ 5" },
        { id: 6, name: "–ª–æ—Ç 3", price: 900, description: "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ 6" }
    ];

    const screens = {
        list: document.getElementById("screen-list"),
        detail: document.getElementById("screen-detail"),
        pay: document.getElementById("screen-pay")
    };

    const lotsGridEl = document.getElementById("lots-grid");
    const detailTitleEl = document.getElementById("detail-title");
    const detailDescEl = document.getElementById("detail-desc");
    const detailPriceEl = document.getElementById("detail-price");
    const qtyValueEl = document.getElementById("qty-value");

    const payNameEl = document.getElementById("pay-name");
    const payQtyEl = document.getElementById("pay-qty");
    const payPriceEl = document.getElementById("pay-price");
    const payTotalEl = document.getElementById("pay-total");

    let currentProduct = null;
    let currentQty = 1;

    function showScreen(name) {
        Object.values(screens).forEach(s => s.classList.remove("active"));
        screens[name].classList.add("active");
    }

    function renderLots() {
        lotsGridEl.innerHTML = "";
        products.forEach(p => {
            const card = document.createElement("article");
            card.className = "lot-card";
            card.dataset.id = p.id;

            card.innerHTML = `
                <div class="lot-image-placeholder"></div>
                <div class="lot-name">${p.name}</div>
                <div class="lot-desc">${p.description}</div>
                <div class="lot-price">${p.price}‚ÇΩ</div>
                <button class="btn btn-outline-green">–ö–£–ü–ò–¢–¨</button>
            `;
            lotsGridEl.appendChild(card);
        });
    }

    function openDetail(productId) {
        const p = products.find(x => x.id === productId);
        if (!p) return;

        currentProduct = p;
        currentQty = 1;
        qtyValueEl.textContent = "1";
        detailTitleEl.textContent = p.name;
        detailDescEl.textContent = p.description;
        detailPriceEl.textContent = `${p.price}‚ÇΩ / —à—Ç.`;

        showScreen("detail");
    }

    function updateQty(delta) {
        let next = currentQty + delta;
        if (next < 1) next = 1;
        if (next > 99) next = 99;
        currentQty = next;
        qtyValueEl.textContent = String(currentQty);
    }

    function preparePayScreen() {
        if (!currentProduct) return;

        const total = currentProduct.price * currentQty;

        payNameEl.textContent = currentProduct.name;
        payQtyEl.textContent = `${currentQty} —à—Ç.`;
        payPriceEl.textContent = `${currentProduct.price}‚ÇΩ`;
        payTotalEl.textContent = `${total}‚ÇΩ`;

        showScreen("pay");
    }

    function sendFakePayment() {
        if (!currentProduct) return;
        const total = currentProduct.price * currentQty;

        const payload = {
            type: "order",
            id: currentProduct.id,
            name: currentProduct.name,
            price: currentProduct.price,
            quantity: currentQty,
            total: total
        };

        if (tg) {
            try {
                tg.sendData(JSON.stringify(payload));
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ sendData:", e);
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑ –≤ –±–æ—Ç–∞.");
                return;
            }
            tg.close();
        } else {
            alert("WebApp –≤–Ω–µ Telegram, –∑–∞–∫–∞–∑: " + JSON.stringify(payload, null, 2));
        }
    }

    // –°–ª—É—à–∞—Ç–µ–ª–∏
    lotsGridEl.addEventListener("click", (e) => {
        const card = e.target.closest(".lot-card");
        if (!card) return;
        const id = Number(card.dataset.id);
        openDetail(id);
    });

    document.querySelectorAll(".qty-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            const delta = Number(btn.dataset.delta);
            updateQty(delta);
        });
    });

    document.getElementById("btn-back-from-detail")
        .addEventListener("click", () => showScreen("list"));

    document.getElementById("btn-to-pay")
        .addEventListener("click", preparePayScreen);

    document.getElementById("btn-back-from-pay")
        .addEventListener("click", () => showScreen("detail"));

    document.getElementById("btn-pay")
        .addEventListener("click", sendFakePayment);

    renderLots();

    if (tg) {
        tg.ready();
        tg.expand();
    }
</script>
</body>
</html>




